# Sprint 3.5: UI/UX Refinement

**Context:** Post-Sprint 3 polish pass before Sprint 4
**Goal:** Refine and harden the current HERMES Messaging + Forum UI/UX based on real usage feedback
**Status:** [x] In Progress (Phase 1 Schema & Store Complete)
**Predecessor:** Sprint 3 â€” âœ… COMPLETE (Dec 6, 2025)

> **Rationale:** Sprint 3 delivered working functionality. Before adding more features (Docs, Bridge), we need to refine the UX to be intuitive and polished. This sprint is driven by hands-on testing and user feedback.

---

## 1. Guiding Principles

1. **Polish Over Features:** No new functionality â€” only refinement of existing flows.
2. **User-Driven:** Issues identified through real usage testing.
3. **Light Touch:** Minimal code changes with maximum UX impact.
4. **No Regressions:** All existing tests must continue to pass.

### 1.1 Engineering Discipline (from `ARCHITECTURE_LOCK.md`)

Even for UI/UX refinement, we maintain strict engineering standards:

- [x] **LOC Cap:** Hard limit of **350 lines** per file. New components (`FlippableCard.tsx`, `ZoomableCard.tsx`, `IDChip.tsx`) must stay under this limit. Split aggressively if needed. âœ… All new files < 105 lines
- [x] **Coverage:** **100%** Line/Branch coverage for new/modified components. âœ… (275 tests, 100% line/branch/function coverage)
- [x] **Browser-Safe:** No `node:*` imports. Pure CSS for animations (no external animation libraries unless already in bundle). âœ…
- [ ] **True Offline Mode:** All new UI must work with `VITE_E2E_MODE=true` â€” no network dependencies for rendering.
- [ ] **Accessibility:** Lighthouse A11y score â‰¥ 90. All interactive elements must be keyboard-navigable and screen-reader friendly.

### 1.2 Privacy Alignment (from `System_Architecture.md`)

**Handles:**
- **Handle is local-first:** Stored on-device in identity record, never written to public mesh.
- **Handle is opt-in sharing:** Only transmitted during explicit contact exchange (QR scan / copy-paste).
- **No handle directory:** We do NOT create a global handle lookup. Handles are local to each user's contact list.
- **Nullifier remains canonical:** Backend operations use nullifier; handle is purely UI display.

**Constituency in Forum (LUMA Integration):**
- **Per-user constituency stays local:** `ConstituencyProof` never leaves device.
- **Only aggregates exposed:** Global counts only in Sprint 3.5.
- **Cohort thresholds:** **N=20** minimum distinct nullifiers per district (per `spec-data-topology-privacy-v0.md` Â§5).
- **No `district_hash` in public events:** Per `spec-data-topology-privacy-v0.md`.
- **"Other Districts" DEFERRED:** Per-district breakdown requires Guardian Node aggregation â€” **deferred to Sprint 4**.
- **Sprint 3.5 Scope:** Show "Your Contribution" (local only) + Global totals. No cross-user district aggregation.

**Handles (Privacy-Compliant):**
- **NOT in DirectoryEntry:** Handles are NOT added to the public Gun directory.
- **Only in QR/Copy payload:** `{ nullifier, epub, handle }` â€” shared peer-to-peer.
- **Stored locally:** `ContactRecord` in localStorage â€” never on mesh.
- **Display priority:** `handle ?? displayName ?? truncated(nullifier)`

---

## 2. Forum UI Refinements

### 2.1 Forum Structural Refactor: Debate-First Layout

**Issue:** The current Forum displays comments in a linear thread with an awkward Argument/Counterpoint card duplication. This creates confusion and doesn't match the VENN bias table's structured debate format.

**Root Problem:** Forum was designed as a traditional comment thread with counterpoints bolted on. We need to invert this â€” **debate structure first, at every level**.

**Solution:** Refactor Forum to use **Concur/Counter columns** as the primary layout (see Â§2.2 for full specification). This eliminates the duplication issue by removing the linear thread entirely.

**Schema Change Required:**
```typescript
// Update HermesComment schema to v1
interface HermesComment {
  // ... existing fields ...
  schemaVersion: 'hermes-comment-v1';  // Bump version
  
  // KEEP: parentId for tree structure
  parentId: string | null;
  
  // NEW: Every comment has a stance
  stance: 'concur' | 'counter';
  
  // DEPRECATED (keep for migration): type and targetId
  type?: 'reply' | 'counterpoint';  // Optional, deprecated
  targetId?: string;                 // Optional, deprecated â€” preserved for legacy counterpoints
}
```

**Migration Plan (Backward Compatible):**
1. **Read path:** Hydrate both old (`type`) and new (`stance`) schemas
   - `type: 'counterpoint'` â†’ `stance: 'counter'`
   - `type: 'reply'` â†’ `stance: 'concur'`
2. **Write path:** Always write `stance`, never write `type`
3. **Preserve `targetId`:** Keep for legacy counterpoints during migration
4. **Dual-parse:** Schema validation accepts both v0 and v1 shapes
5. **Deprecation timeline:** Remove `type` field in Sprint 4

**Zod Schema Implementation (Explicit Dual-Parse):**
```typescript
// packages/data-model/src/schemas/hermes/forum.ts

// v0 Schema (deprecated, read-only)
const HermesCommentSchemaV0 = z.object({
  schemaVersion: z.literal('hermes-comment-v0'),
  type: z.enum(['reply', 'counterpoint']),
  targetId: z.string().optional(),
  // ... other fields
});

// v1 Schema (current, read/write)
const HermesCommentSchemaV1 = z.object({
  schemaVersion: z.literal('hermes-comment-v1'),
  stance: z.enum(['concur', 'counter']),
  type: z.enum(['reply', 'counterpoint']).optional(), // deprecated, read-only
  targetId: z.string().optional(), // deprecated, preserved for migration
  // ... other fields
});

// Union for hydration (accepts both)
export const HermesCommentSchema = z.union([
  HermesCommentSchemaV0,
  HermesCommentSchemaV1
]);

// Canonical output schema (v1 only, for writes)
export const HermesCommentWriteSchema = HermesCommentSchemaV1.omit({ type: true });
```

**Test Requirement:**
- [x] Unit test: v0 inputs are never written to Gun (only v1 shape exits write path) âœ…
- [x] Unit test: v0 inputs hydrate correctly with stance mapping âœ…
- [x] Unit test: v1 inputs pass through unchanged âœ…

**Requirements:**
- [x] Update `HermesCommentSchema` with `stance: 'concur' | 'counter'` âœ…
- [x] Remove `type` field (or deprecate) âœ… (deprecated, preserved for migration)
- [x] Update store with `getConcurComments`, `getCounterComments` selectors âœ…
- [ ] Update UI to use Concur/Counter columns at every level (IN PROGRESS)
- [x] Migration path for existing comments (`migrateCommentToV1`) âœ…
- [ ] See Â§2.2 for full UI specification

**Files Modified:**
- âœ… `packages/data-model/src/schemas/hermes/forum.ts` â€” Schema change (v0/v1 union, `migrateCommentToV1`)
- âœ… `packages/data-model/src/schemas/hermes/forum.test.ts` â€” 23 tests covering all schema paths
- âœ… `apps/web-pwa/src/store/forum/index.ts` â€” Store updates (`getConcurComments`, `getCounterComments`)
- âœ… `apps/web-pwa/src/store/forum/types.ts` â€” Updated comment types with `stance`
- âœ… `apps/web-pwa/src/store/forum/mockStore.ts` â€” Mock store supports `stance`
- âœ… `packages/types/src/index.ts` â€” Type exports
- â³ `apps/web-pwa/src/components/hermes/ThreadView.tsx` â€” Major refactor (IN PROGRESS)
- âœ… `apps/web-pwa/src/components/hermes/CommentCard.tsx` â€” NEW (debate card)
- âœ… `apps/web-pwa/src/components/hermes/DebateColumn.tsx` â€” NEW (Concur/Counter column)
- âœ… `apps/web-pwa/src/components/hermes/ZoomableCard.tsx` â€” NEW (zoom overlay)
- âœ… `apps/web-pwa/src/hooks/useZoomNavigation.ts` â€” NEW (17 tests, Escape handling)

---

### 2.2 VENN â†’ Forum Transition (Structured Debate Format)

**Vision:** The Forum mirrors VENN's bias table â€” structured as **Point vs Counterpoint** at every level. When flipping from article to discussion, you see the community's reaction organized as a debate, not a linear thread.

**Core Concept:**
- **VENN (Front):** Article Summary + Bias Table (Frame vs Reframe)
- **Forum (Back):** Community Summary + Debate Columns (Concur vs Counter)
- **Recursive Structure:** Every comment can have its own Concur/Counter threads within it

**Animation Specification:**
- **Type:** 3D card flip
- **What flips:** ONLY the Summary + Bias Table section
- **What stays:** Headline/Topic remains visible at top (anchor point)
- **Reveals:** Debate-structured discussion on the "back"

**Expected Behavior:**
```
VENN Article View (FRONT)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Headline: "Climate Bill Passes Senate"                       â”‚ â† STAYS FIXED
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚                                                          â”‚ â”‚
â”‚ â”‚   ARTICLE SUMMARY                                        â”‚ â”‚
â”‚ â”‚   "The Senate voted 52-48 to pass the Climate..."        â”‚ â”‚
â”‚ â”‚                                                          â”‚ â”‚
â”‚ â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚ â”‚   â”‚ FRAME                  â”‚ REFRAME                   â”‚ â”‚ â”‚
â”‚ â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚
â”‚ â”‚   â”‚ "Historic victory"     â”‚ "Insufficient action"     â”‚ â”‚ â”‚
â”‚ â”‚   â”‚ [+12][-3]              â”‚ [+8][-5]                  â”‚ â”‚ â”‚
â”‚ â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚
â”‚ â”‚   â”‚ "Bipartisan support"   â”‚ "Watered down compromise" â”‚ â”‚ â”‚
â”‚ â”‚   â”‚ [+6][-2]               â”‚ [+4][-1]                  â”‚ â”‚ â”‚
â”‚ â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚ â”‚                                                          â”‚ â”‚
â”‚ â”‚   [ğŸ’¬ Discuss in Forum] â† Click to flip                  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                         â†“ 3D Card Flip Animation â†“

Forum Discussion View (BACK)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Headline: "Climate Bill Passes Senate"                       â”‚ â† SAME HEADLINE
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚                                                          â”‚ â”‚
â”‚ â”‚   COMMUNITY REACTION SUMMARY                             â”‚ â”‚
â”‚ â”‚   47 participants â€¢ 23 Concur, 24 Counter                â”‚ â”‚
â”‚ â”‚   ğŸ“ Your district: 12 participants (8 Concur, 4 Counter)â”‚ â”‚
â”‚ â”‚   "Mixed reception with strong support for compromise,   â”‚ â”‚
â”‚ â”‚    but concerns about implementation timeline..."        â”‚ â”‚
â”‚ â”‚                                                          â”‚ â”‚
â”‚ â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚ â”‚   â”‚ ğŸ‘ CONCUR (23)         â”‚ ğŸ‘ COUNTER (24)           â”‚ â”‚ â”‚
â”‚ â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚
â”‚ â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚
â”‚ â”‚   â”‚ â”‚ "Finally, logic!   â”‚ â”‚ â”‚ "Too little too late. â”‚ â”‚ â”‚ â”‚
â”‚ â”‚   â”‚ â”‚  This is exactly   â”‚ â”‚ â”‚  We needed this 20    â”‚ â”‚ â”‚ â”‚
â”‚ â”‚   â”‚ â”‚  what we needed."  â”‚ â”‚ â”‚  years ago."          â”‚ â”‚ â”‚ â”‚
â”‚ â”‚   â”‚ â”‚        â€” @alice    â”‚ â”‚ â”‚        â€” @bob         â”‚ â”‚ â”‚ â”‚
â”‚ â”‚   â”‚ â”‚ [â–² 12] [3 replies] â”‚ â”‚ â”‚ [â–² 8] [5 replies]     â”‚ â”‚ â”‚ â”‚
â”‚ â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚
â”‚ â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚
â”‚ â”‚   â”‚ â”‚ "The bipartisan    â”‚ â”‚ â”‚ "They gutted the key  â”‚ â”‚ â”‚ â”‚
â”‚ â”‚   â”‚ â”‚  angle is huge..." â”‚ â”‚ â”‚  provisions..."       â”‚ â”‚ â”‚ â”‚
â”‚ â”‚   â”‚ â”‚        â€” @charlie  â”‚ â”‚ â”‚        â€” @dana        â”‚ â”‚ â”‚ â”‚
â”‚ â”‚   â”‚ â”‚ [â–² 6] [1 reply]    â”‚ â”‚ â”‚ [â–² 4] [2 replies]     â”‚ â”‚ â”‚ â”‚
â”‚ â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚
â”‚ â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚ â”‚                                                          â”‚ â”‚
â”‚ â”‚   [+ Add Concur]              [+ Add Counter]            â”‚ â”‚
â”‚ â”‚                                                          â”‚ â”‚
â”‚ â”‚   [â† Back to Analysis]                                   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Clicking a Comment â†’ Zoom with Nested Debate:**
When user clicks on any comment (e.g., Alice's "Finally, logic!"), it zooms to fill the width and floats above the dimmed discussion. That comment itself has its own Point/Counterpoint structure:

```
Zoomed Comment View (floats above dimmed discussion)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â”‚
â”‚â–‘â–‘â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â–‘â–‘â”‚
â”‚â–‘â–‘â”‚                                                        â”‚â–‘â–‘â”‚
â”‚â–‘â–‘â”‚  @alice â€¢ 2h ago                              [â–² 12 â–¼] â”‚â–‘â–‘â”‚
â”‚â–‘â–‘â”‚                                                        â”‚â–‘â–‘â”‚
â”‚â–‘â–‘â”‚  "Finally, logic prevails! This is exactly what we     â”‚â–‘â–‘â”‚
â”‚â–‘â–‘â”‚   needed. The compromise shows that governance can     â”‚â–‘â–‘â”‚
â”‚â–‘â–‘â”‚   still work when people put aside ideology."          â”‚â–‘â–‘â”‚
â”‚â–‘â–‘â”‚                                                        â”‚â–‘â–‘â”‚
â”‚â–‘â–‘â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â–‘â–‘â”‚
â”‚â–‘â–‘â”‚  â”‚ ğŸ‘ CONCUR (8)        â”‚ ğŸ‘ COUNTER (4)             â”‚ â”‚â–‘â–‘â”‚
â”‚â–‘â–‘â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚â–‘â–‘â”‚
â”‚â–‘â–‘â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚â–‘â–‘â”‚
â”‚â–‘â–‘â”‚  â”‚ â”‚ "Exactly! This   â”‚ â”‚ â”‚ "Logic? They exempted  â”‚ â”‚ â”‚â–‘â–‘â”‚
â”‚â–‘â–‘â”‚  â”‚ â”‚  proves the      â”‚ â”‚ â”‚  the worst polluters!" â”‚ â”‚ â”‚â–‘â–‘â”‚
â”‚â–‘â–‘â”‚  â”‚ â”‚  system works."  â”‚ â”‚ â”‚       â€” @frank         â”‚ â”‚ â”‚â–‘â–‘â”‚
â”‚â–‘â–‘â”‚  â”‚ â”‚      â€” @eve      â”‚ â”‚ â”‚ [â–² 3] [1 reply]        â”‚ â”‚ â”‚â–‘â–‘â”‚
â”‚â–‘â–‘â”‚  â”‚ â”‚ [â–² 5] [2 replies]â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚â–‘â–‘â”‚
â”‚â–‘â–‘â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                            â”‚ â”‚â–‘â–‘â”‚
â”‚â–‘â–‘â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â–‘â–‘â”‚
â”‚â–‘â–‘â”‚                                                        â”‚â–‘â–‘â”‚
â”‚â–‘â–‘â”‚  [+ Add Concur]              [+ Add Counter]           â”‚â–‘â–‘â”‚
â”‚â–‘â–‘â”‚                                                        â”‚â–‘â–‘â”‚
â”‚â–‘â–‘â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â–‘â–‘â”‚
â”‚â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â–‘â–‘ = Dimmed backdrop (click to dismiss back to thread)
```

**Infinite Nesting:**
- Click @eve's "Exactly! This proves..." â†’ zooms again, with ITS OWN Concur/Counter columns
- Click @frank's "Logic? They exempted..." â†’ zooms, with ITS OWN Concur/Counter columns
- Each level maintains the Point/Counterpoint debate structure
- Stacked cards breadcrumb shows depth (see Â§2.3)

**No Existing Thread (Empty State):**
```
Forum Discussion View (empty)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Headline: "Climate Bill Passes Senate"                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚                                                          â”‚ â”‚
â”‚ â”‚   ğŸ’¬ No discussion yet                                   â”‚ â”‚
â”‚ â”‚                                                          â”‚ â”‚
â”‚ â”‚   Be the first to share your thoughts                    â”‚ â”‚
â”‚ â”‚                                                          â”‚ â”‚
â”‚ â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚ â”‚   â”‚ ğŸ‘ START A CONCUR      â”‚ ğŸ‘ START A COUNTER        â”‚ â”‚ â”‚
â”‚ â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚
â”‚ â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚
â”‚ â”‚   â”‚ â”‚ I support this     â”‚ â”‚ â”‚ I have concerns       â”‚ â”‚ â”‚ â”‚
â”‚ â”‚   â”‚ â”‚ because...         â”‚ â”‚ â”‚ because...            â”‚ â”‚ â”‚ â”‚
â”‚ â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚
â”‚ â”‚   â”‚ [Post Concur]          â”‚ [Post Counter]            â”‚ â”‚ â”‚
â”‚ â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚ â”‚                                                          â”‚ â”‚
â”‚ â”‚   [â† Back to Analysis]                                   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Community Reaction Summary â€” Civic Action Seed:**

The summary is the **foundation for civic action** â€” it can be converted into:
- **Sentiment Report** â†’ Send to local representatives (Sprint 4: Sovereign Legislative Bridge)
- **Policy Proposal** â†’ Elevate to Quadratic Funding for community backing
- **Community Project** â†’ Become a funded initiative

**Summary Components (Sprint 3.5 Scope):**

> **Privacy Constraint:** Per `spec-data-topology-privacy-v0.md`, per-district aggregation requires **N=20** minimum distinct nullifiers AND secure aggregation via Guardian Nodes. Cross-user district breakdown is **DEFERRED to Sprint 4**.

1. **Computed Metrics (Global â€” Public Data):**
   - Total participants (count of unique authors)
   - Concur count vs Counter count
   - ~~Per-district breakdown~~ â†’ **DEFERRED (Sprint 4)**
   
2. **Your Contribution (Local Only):**
   - "You participated in this discussion" indicator
   - Your stance (if you commented)
   - ~~Your district's stance~~ â†’ **DEFERRED (Sprint 4)**

3. **AI-Generated Summary (Local WebLLM):**
   - 1-2 sentence synthesis of the debate
   - Key themes from Concur side
   - Key themes from Counter side
   - **Engine:** Local WebLLM (`@vh/ai-engine`) â€” stays offline-compatible
   - **Regeneration:** Debounced (**45 seconds** after last comment) OR manual "Refresh Summary" button
   - **Manual refresh:** Always available via "ğŸ”„ Refresh Summary" button

**AI Summary Prompt Template:**
```
Summarize the following community discussion into two categories.

CONCUR ARGUMENTS (supporting the topic):
{concur_comments}

COUNTER ARGUMENTS (opposing the topic):
{counter_comments}

Provide:
1. A 1-2 sentence neutral summary of the overall debate
2. The main theme from CONCUR arguments (1 sentence)
3. The main theme from COUNTER arguments (1 sentence)

RULES:
- Be neutral and factual
- Do NOT include usernames or handles
- Do NOT include any personally identifiable information
- Focus on the substance of the arguments
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ COMMUNITY REACTION SUMMARY                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 47 participants â€¢ 23 Concur, 24 Counter                      â”‚
â”‚                                                              â”‚
â”‚ âœ… You participated (Concur)                                 â”‚
â”‚                                                              â”‚
â”‚ ğŸ“Š DISTRICT BREAKDOWN                                        â”‚
â”‚    ğŸ”’ Requires verified constituency (Coming in Sprint 4)   â”‚
â”‚                                                              â”‚
â”‚ ğŸ’¬ AI SUMMARY:                                               â”‚
â”‚ "Mixed reception. Supporters cite bipartisan cooperation    â”‚
â”‚  and incremental progress. Critics argue exemptions for     â”‚
â”‚  major polluters undermine the bill's effectiveness."       â”‚
â”‚                        [ğŸ”„ Refresh Summary]                  â”‚
â”‚                                                              â”‚
â”‚ [ğŸ“¤ Send to Rep] [ğŸ“ Draft Proposal] [ğŸ’¡ Start Project]      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> **âš ï¸ ILLUSTRATIVE ONLY:** The diagram above shows the *future* Sprint 4 state. In Sprint 3.5, the "DISTRICT BREAKDOWN" section renders ONLY the lock placeholder. No per-district rows are displayed. Tests must assert that no district data renders without Guardian/Bridge infrastructure.

**Requirements:**
- [ ] **3D card flip animation** â€” CSS perspective transform on the content area
- [ ] **Headline anchored** â€” Topic/headline stays fixed at top during flip
- [ ] **VENN on "front"** â€” Article Summary + Bias Table (Frame/Reframe)
- [ ] **Forum on "back"** â€” Community Summary + Debate Columns (Concur/Counter)
- [ ] **Computed metrics** â€” Participant count, Concur/Counter breakdown (global only)
- [ ] **Your contribution indicator** â€” Show if current user participated + their stance
- [ ] **District breakdown placeholder** â€” "Coming in Sprint 4" with lock icon (DEFERRED)
- [ ] **AI summary** â€” Local WebLLM-generated synthesis with debounced regeneration
- [ ] **Action buttons (non-destructive modal):**
  - Buttons are VISIBLE and CLICKABLE (not greyed out â€” accessibility)
  - On click: Show modal "Coming in Sprint 4 (Bridge)"
  - Modal requirements:
    - `role="dialog"` and `aria-modal="true"`
    - Focus trap inside modal (Tab cycles within modal)
    - Escape key closes modal
    - `aria-describedby` links to coming-soon explanation
  - **No "Notify me"** â€” Would require network infrastructure; out of scope for 3.5
- [ ] **Two-column debate layout** â€” Concur (left) and Counter (right) columns
- [ ] **Click-to-zoom comments** â€” Any comment zooms to fill width, floats above dimmed thread
- [ ] **Nested debate structure** â€” Every comment has its own Concur/Counter columns
- [ ] **Stacked cards breadcrumb** â€” Shows depth when zoomed multiple levels (see Â§2.3)
- [ ] **Empty state** â€” Two input fields: "Start a Concur" and "Start a Counter"
- [ ] **Reverse flip** â€” "Back to Analysis" returns to VENN view
- [ ] **Deep link support** â€” Direct URL to thread shows Forum side directly

**Files to Modify:**
- `apps/web-pwa/src/components/venn/AnalysisView.tsx`
- New: `FlippableCard.tsx` wrapper component with CSS 3D transforms
- `apps/web-pwa/src/components/hermes/ThreadView.tsx` â€” Major refactor to debate layout
- `apps/web-pwa/src/components/hermes/DebateColumn.tsx` â€” NEW: Concur/Counter column
- `apps/web-pwa/src/components/hermes/CommentCard.tsx` â€” NEW: Zoomable comment with nested debate
- `apps/web-pwa/src/routes/hermes/forum/$threadId.tsx`
- `packages/data-model/src/schemas/hermes/forum.ts` â€” Add `stance: 'concur' | 'counter'` to comments

---

### 2.3 Zoom Animation & Depth Navigation

**Vision:** Deep nested debates are navigated via zoom animation. Clicking any comment in the Concur or Counter columns zooms it to fill the width, revealing its own nested debate.

**Animation Specification:**
- **Type:** CSS animation (NOT route change)
- **Transform:** Scale + position + z-index elevation
- **Backdrop:** Dimmed overlay behind zoomed card
- **Dismissal:** Click backdrop OR swipe back to return

**Key Concept:** 
- Click any comment in Concur or Counter column â†’ zooms to fill width
- That comment reveals its OWN Concur/Counter columns within it
- Can zoom infinitely deep into nested debates
- Navigate back by clicking backdrop, parent card edge, or swiping

**Depth Indicator â€” Stacked Cards:**
When zoomed multiple levels deep, show previous cards as a "fanned deck" â€” each parent card shows just a 1px border at the top edge.

```
Zoomed 3 levels deep into a debate:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â”‚
â”‚â–‘â–‘â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â–‘â–‘â”‚ â† Thread root (Level 0)
â”‚â–‘â–‘â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â–‘â–‘â”‚ â† @alice's concur (Level 1)
â”‚â–‘â–‘â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â–‘â–‘â”‚ â† @frank's counter (Level 2)
â”‚â–‘â–‘â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â–‘â–‘â”‚
â”‚â–‘â–‘â”‚                                                        â”‚â–‘â–‘â”‚
â”‚â–‘â–‘â”‚  @grace â€¢ 30m ago                             [â–² 2 â–¼]  â”‚â–‘â–‘â”‚
â”‚â–‘â–‘â”‚                                                        â”‚â–‘â–‘â”‚
â”‚â–‘â–‘â”‚  "Actually, the exemptions make sense because..."      â”‚â–‘â–‘â”‚
â”‚â–‘â–‘â”‚                                                        â”‚â–‘â–‘â”‚
â”‚â–‘â–‘â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â–‘â–‘â”‚
â”‚â–‘â–‘â”‚  â”‚ ğŸ‘ CONCUR (1)        â”‚ ğŸ‘ COUNTER (0)             â”‚ â”‚â–‘â–‘â”‚
â”‚â–‘â–‘â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚â–‘â–‘â”‚
â”‚â–‘â–‘â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                            â”‚ â”‚â–‘â–‘â”‚
â”‚â–‘â–‘â”‚  â”‚ â”‚ "Good point!"    â”‚ â”‚  Be the first to counter  â”‚ â”‚â–‘â–‘â”‚
â”‚â–‘â–‘â”‚  â”‚ â”‚     â€” @henry     â”‚ â”‚                            â”‚ â”‚â–‘â–‘â”‚
â”‚â–‘â–‘â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  [+ Add Counter]           â”‚ â”‚â–‘â–‘â”‚
â”‚â–‘â–‘â”‚  â”‚ [+ Add Concur]       â”‚                            â”‚ â”‚â–‘â–‘â”‚
â”‚â–‘â–‘â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â–‘â–‘â”‚
â”‚â–‘â–‘â”‚                                                        â”‚â–‘â–‘â”‚
â”‚â–‘â–‘â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â–‘â–‘â”‚
â”‚â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†‘
   Click any parent card edge OR backdrop to zoom back
```

**Requirements:**
- [x] **Click-to-zoom** â€” Clicking any comment card in Concur/Counter columns triggers zoom âœ…
- [x] **Scale + translate animation** â€” Card scales up and fills available width âœ…
- [x] **Z-index elevation** â€” Zoomed card rises above other content âœ…
- [x] **Dimmed backdrop** â€” Semi-transparent overlay behind zoomed card âœ…
- [x] **Stacked card breadcrumb** â€” Parent cards show 1px top border (fanned deck effect) âœ…
- [x] **Click parent edge to zoom back** â€” Clicking a parent card's visible edge returns to that level âœ…
- [x] **Backdrop dismissal** â€” Click backdrop to return to thread root âœ…
- [ ] **Swipe back (mobile)** â€” Native gesture to return to parent level
- [x] **Nested debate structure** â€” Every zoomed comment shows its own Concur/Counter columns âœ…
- [x] **No route change** â€” URL stays the same (zoom state is visual only) âœ…
- [x] **Escape key dismissal** â€” Press Escape to zoom out one level âœ…

**Files Created/Modified:**
- âœ… `apps/web-pwa/src/components/hermes/ZoomableCard.tsx` (67 lines)
- âœ… `apps/web-pwa/src/components/hermes/CommentCard.tsx` (105 lines)
- âœ… `apps/web-pwa/src/hooks/useZoomNavigation.ts` (31 lines, 17 tests)
- âœ… `apps/web-pwa/src/hooks/useZoomNavigation.test.ts` â€” Full test coverage

---

### 2.4 [PLACEHOLDER: Additional forum refinements]

**Issue:** _To be filled in during testing_

**Requirements:**
- [ ] TBD

---

## 3. Messaging UI Refinements

### 3.1 Clean, Modern Messaging Layout

**Vision:** Standard messaging format â€” contacts left, conversation right, always accessible.

**Frictionless Contact Sharing Flow:**
```
Any Page â†’ Tap ğŸ’¬ in Navbar â†’ Tap ID Chip â†’ Share QR/Copy ID
```

**Expected Behavior:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â˜°  VENN / HERMES / AGORA                              ğŸŒ™  ğŸ‘¤ User  ğŸ’¬      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Contacts         â”‚  â”‚ â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— â”‚  â”‚
â”‚  â”‚                  â”‚  â”‚ â•‘  [ğŸªª ID Chip]  Show QR â”‚ Copy ID           â•‘ â”‚  â”‚ â† FIXED
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚  â”‚   POSITION
â”‚  â”‚ â”‚ ğŸ‘¤ Alice     â”‚ â”‚  â”‚                                                â”‚  â”‚
â”‚  â”‚ â”‚ Last msg...  â”‚ â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚  â”‚                                         â”‚  â”‚  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚  â”‚        Conversation Area                â”‚  â”‚  â”‚
â”‚  â”‚ â”‚ ğŸ‘¤ Bob       â”‚ â”‚  â”‚  â”‚        (scrollable)                     â”‚  â”‚  â”‚
â”‚  â”‚ â”‚ Hey there... â”‚ â”‚  â”‚  â”‚                                         â”‚  â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                  â”‚  â”‚                                                â”‚  â”‚
â”‚  â”‚                  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚                  â”‚  â”‚  â”‚ Type a message...              [Send]   â”‚  â”‚  â”‚
â”‚  â”‚                  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ID Chip Specification:**
- **Position:** Fixed at top of Messages view (always visible, even while scrolling)
- **Content:** Shows YOUR ID only (for sharing with others)
- **Actions:**
  - "Show QR" â€” Displays QR code modal
  - "Copy ID" â€” Copies ID to clipboard with confirmation toast

**Requirements:**
- [ ] **Contact list left panel** â€” Shows recent conversations, sorted by last message
- [ ] **Contact names** â€” Display user's **handle** (not raw nullifier) â€” see Â§3.2
- [ ] **Main conversation right panel** â€” Fills available space
- [ ] **ID Chip (fixed position)** â€” Always visible at top, doesn't scroll with messages
  - [ ] "Show QR" button
  - [ ] "Copy ID" button with clipboard + toast feedback
- [ ] **Most recent conversation persists** â€” On return to Messages, last active chat is visible
- [ ] **Responsive sizing** â€” Composer always visible without scrolling
- [ ] **Navbar message icon** â€” ğŸ’¬ icon in global nav, accessible from any page

**Files to Modify:**
- `apps/web-pwa/src/components/hermes/ChatLayout.tsx`
- `apps/web-pwa/src/components/hermes/ChannelList.tsx`
- `apps/web-pwa/src/components/hermes/Composer.tsx`
- `apps/web-pwa/src/components/hermes/ContactQR.tsx` â†’ Rename to `IDChip.tsx`
- `apps/web-pwa/src/components/layout/Navbar.tsx` (add messages icon)

---

### 3.2 User Handles (Display Names)

**Vision:** Users see friendly display names, not raw nullifiers.

**Handle Specification:**
- **Format:** Alphanumeric + underscores only (like Twitter)
- **Length:** 3-20 characters
- **Uniqueness:** NOT enforced globally â€” duplicates allowed
- **Discriminator:** If duplicates appear in same user's contact list, show discriminator (e.g., "Alice" and "Alice (2)")
- **When set:** During onboarding (required), can change in Settings anytime

**Current Behavior:**
- Contacts show as `dev-nullif...` (truncated nullifier)
- No way for users to set a custom name

**Expected Behavior:**
```
Onboarding Flow:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                          â”‚
â”‚   Choose your handle                     â”‚
â”‚                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚ @___________________               â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚   3-20 characters (letters, numbers, _)  â”‚
â”‚                                          â”‚
â”‚   [Continue]                             â”‚
â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Contact List (with duplicate handling):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ‘¤ Alice         â”‚  â† Only one Alice
â”‚ ğŸ‘¤ Bob           â”‚
â”‚ ğŸ‘¤ Charlie       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Contact List (with duplicates):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ‘¤ Alice         â”‚  â† First Alice added
â”‚ ğŸ‘¤ Alice (2)     â”‚  â† Second Alice, discriminator added
â”‚ ğŸ‘¤ Bob           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Contact Exchange Data (updated):**
```json
{
  "nullifier": "dev-nullifier-abc123...",
  "epub": "abc123...",
  "handle": "Alice"
}
```

**Requirements:**
- [ ] **Handle field in identity** â€” Add `handle: string` to identity record (required in-app, validated at UI layer)
- [ ] **Onboarding step** â€” Required handle entry during first-time setup
- [ ] **Settings edit** â€” Can change handle anytime in Settings
- [ ] **Validation** â€” Alphanumeric + underscore, 3-20 chars
- [ ] **Contact exchange includes handle** â€” QR/copied data includes `{ nullifier, epub, handle }`
- [ ] **Display handle in UI** â€” Channel list, message headers show handle
- [ ] **Display priority** â€” `handle ?? displayName ?? truncated(nullifier)`
- [ ] **Discriminator for duplicates** â€” If same handle appears twice in contacts, append "(2)", "(3)", etc.
- [ ] **Fallback to truncated nullifier** â€” If no handle (legacy contacts), show `dev-nul...`

**Privacy Compliance:**
- [ ] **NOT in DirectoryEntry** â€” Handles are NOT added to the public Gun directory
- [ ] **Only in QR/Copy payload** â€” Shared peer-to-peer during contact exchange
- [ ] **Stored locally** â€” `ContactRecord` in localStorage (`vh_contacts:<nullifier>`)

**Files to Modify:**
- `apps/web-pwa/src/hooks/useIdentity.ts` â€” Add handle to IdentityRecord
- `apps/web-pwa/src/routes/onboarding.tsx` â€” Handle entry step (new or update)
- `apps/web-pwa/src/routes/settings.tsx` â€” Handle edit UI
- `apps/web-pwa/src/components/hermes/IDChip.tsx` â€” Include handle in QR/copy data
- `apps/web-pwa/src/components/hermes/ChannelList.tsx` â€” Display handle + discriminator logic
- `apps/web-pwa/src/components/hermes/MessageBubble.tsx` â€” Display handle
- `apps/web-pwa/src/store/chat/types.ts` â€” Add `handle?: string` to ContactRecord
- ~~`packages/data-model/src/schemas/hermes/directory.ts`~~ â€” **REMOVED** (privacy compliance)

---

### 3.3 [PLACEHOLDER: Additional messaging refinements]

**Issue:** _To be filled in during testing_

**Requirements:**
- [ ] TBD

---

## 4. General UI/UX Refinements

### 4.1 [PLACEHOLDER: Navigation, layout, visual issues]

**Issue:** _To be filled in during testing_

**Current Behavior:**

**Expected Behavior:**

**Requirements:**
- [ ] TBD

---

## 5. Accessibility Refinements

> **Requirement:** Lighthouse A11y score â‰¥ 90 (per `System_Architecture.md` Â§3.3)

### 5.1 Baseline A11y Requirements

All Sprint 3.5 UI changes must meet:

**Requirements:**
- [ ] **Keyboard navigation** â€” All interactive elements reachable via Tab key
- [ ] **Focus indicators** â€” Visible focus ring on all interactive elements
- [ ] **ARIA labels** â€” Zoomed cards, backdrop, flip cards have appropriate `aria-label` and `role`
- [ ] **Screen reader** â€” Card zoom/flip state changes announced via `aria-live`
- [ ] **Reduced motion** â€” Respect `prefers-reduced-motion` media query (skip animations)
- [ ] **Color contrast** â€” All text meets WCAG AA (4.5:1 for body, 3:1 for large text)

### 5.2 Specific A11y for New Components

**ZoomableCard:**
- [ ] `role="dialog"` when zoomed
- [ ] `aria-modal="true"` when zoomed
- [ ] Focus trapped inside zoomed card
- [ ] Escape key dismisses zoom

**FlippableCard:**
- [ ] `aria-expanded` attribute reflects flip state
- [ ] Flip action announced to screen readers
- [ ] Both faces accessible when focused

**IDChip:**
- [ ] Clear button labels ("Show QR Code", "Copy your ID")
- [ ] Copy success announced via `aria-live="polite"`

### 5.3 [PLACEHOLDER: Additional a11y issues as discovered]

**Issue:** _To be filled in during testing_

**Requirements:**
- [ ] TBD

---

## 6. Performance Refinements

> **Requirement:** Bundle budget â‰¤ 1 MiB gzip (per `ARCHITECTURE_LOCK.md` Â§2.3)

### 6.1 Animation Performance

**Requirements:**
- [ ] **CSS-only animations** â€” No JavaScript animation libraries for zoom/flip (use `transform`, `opacity`)
- [ ] **GPU-accelerated** â€” Use `transform` and `opacity` (not `width`, `height`, `top`, `left`)
- [ ] **60fps target** â€” No jank during card zoom or flip animations
- [ ] **Reduced motion fallback** â€” Instant state changes for users who prefer reduced motion

### 6.2 [PLACEHOLDER: Additional performance issues as discovered]

**Issue:** _To be filled in during testing_

**Requirements:**
- [ ] TBD

---

## 6.5 E2E Mode Compatibility

> **Requirement:** All UI must work with `VITE_E2E_MODE=true` (per `ARCHITECTURE_LOCK.md` Â§2.2)

**Requirements:**
- [ ] **Card animations work offline** â€” No network calls during zoom/flip
- [ ] **Handle persistence** â€” Works with mock identity store
- [ ] **ID Chip** â€” QR generation works without network
- [ ] **All manual tests pass** â€” Repeat manual tests in E2E mode

---

## 7. Implementation Priority

| ID | Issue | Component | Priority | Status |
|----|-------|-----------|----------|--------|
| 2.1 | Forum structural refactor (Concur/Counter debate format) | Forum/Schema | HIGH | âœ… COMPLETE |
| 2.1a | Schema v1 with stance (Zod union, migration helper) | Schema | HIGH | âœ… COMPLETE |
| 2.1b | Store selectors (getConcurComments, getCounterComments) | Store | HIGH | âœ… COMPLETE |
| 2.1c | UI components (DebateColumn, CommentCard) | UI | HIGH | âœ… COMPLETE |
| 2.2 | VENN â†’ Forum 3D card flip | Forum/VENN | HIGH | [ ] |
| 2.2a | Community Reaction Summary (metrics + AI + LUMA) | Forum/LUMA | HIGH | [ ] |
| 2.2b | Civic Action buttons (disabled placeholders for Sprint 4) | Forum | MEDIUM | [ ] |
| 2.3 | Zoom animation + depth navigation (stacked cards) | Forum | HIGH | âœ… COMPLETE |
| 2.3a | ZoomableCard overlay component | UI | HIGH | âœ… COMPLETE |
| 2.3b | useZoomNavigation hook with Escape handling | Hook | HIGH | âœ… COMPLETE |
| 3.1 | Clean messaging layout + fixed ID Chip | Messaging | HIGH | [ ] |
| 3.1a | Navbar messages icon (ğŸ’¬) | Global | MEDIUM | [ ] |
| 3.2 | User handles (display names) | Identity/Messaging | HIGH | [ ] |

**Phase 1 Complete (Dec 7, 2025):**
- âœ… Schema migration to v1 with `stance: 'concur' | 'counter'`
- âœ… Zod union for backward-compatible hydration
- âœ… `migrateCommentToV1()` helper with full test coverage
- âœ… Store selectors for debate layout
- âœ… UI components: `CommentCard`, `DebateColumn`, `ZoomableCard`
- âœ… `useZoomNavigation` hook with Escape key handling
- âœ… **275 tests passing, 100% coverage (lines, branches, functions)**

**Phase 2 (Next):**
- [ ] VENN â†’ Forum 3D card flip animation
- [ ] Community Reaction Summary component
- [ ] Clean messaging layout with ID Chip
- [ ] User handles

**Sprint 4 Bridge:** The "Send to Rep", "Draft Proposal", and "Start Project" buttons (2.2b) are placeholders that will be wired in Sprint 4 (Sovereign Legislative Bridge).

---

## 8. Testing Checklist

### 8.1 Forum Debate Structure Tests
- [ ] Thread displays two columns: Concur (left) and Counter (right)
- [ ] "Community Reaction Summary" shows at top (participant count, sentiment)
- [ ] Add Concur comment â€” appears in Concur column
- [ ] Add Counter comment â€” appears in Counter column
- [ ] Comments show handle, timestamp, vote count
- [ ] Vote on comment â€” updates score

### 8.2 Forum Zoom Navigation Tests
- [ ] Click any comment â€” zooms to fill width with CSS animation
- [ ] Zoomed comment shows its OWN Concur/Counter columns
- [ ] Dimmed backdrop appears behind zoomed card
- [ ] Click backdrop â€” returns to previous level
- [ ] **Stacked cards breadcrumb** â€” Parent cards show 1px border at top (fanned deck)
- [ ] **Click parent edge** â€” Returns to that level directly
- [ ] Deep nesting â€” can zoom 3+ levels into nested debates
- [ ] Add Concur/Counter from zoomed view â€” appears in correct column
- [ ] Swipe back (mobile) â€” returns to parent level

### 8.3 VENN â†’ Forum Transition Tests
- [ ] Click "Discuss in Forum" on article â€” 3D card flip animation
- [ ] Headline stays anchored at top during flip
- [ ] Summary/Bias section (FRONT) flips to reveal Forum (BACK)
- [ ] Forum shows Community Reaction Summary + Concur/Counter columns
- [ ] Navigate back to article â€” reverse flip animation
- [ ] **Empty thread state** â€” Shows "Start a Concur" and "Start a Counter" inputs
- [ ] Can post first Concur or Counter from empty state
- [ ] Direct link to thread works independently

### 8.4 Community Reaction Summary Tests
- [ ] Shows total participant count (global)
- [ ] Shows Concur vs Counter breakdown (global)
- [ ] Shows "You participated" indicator if current user commented
- [ ] Shows AI-generated summary of debate themes
- [ ] **"Refresh Summary" button** â€” Regenerates AI summary
- [ ] **District breakdown placeholder** â€” Shows "Coming in Sprint 4" with lock icon
- [ ] ~~Other districts~~ â€” **DEFERRED** (not implemented in 3.5)
- [ ] **Action buttons (non-destructive):**
  - [ ] "Send to Rep" button â€” Clickable, opens "Coming in Sprint 4" modal
  - [ ] "Draft Proposal" button â€” Clickable, opens "Coming in Sprint 4" modal
  - [ ] "Start Project" button â€” Clickable, opens "Coming in Sprint 4" modal
  - [ ] All buttons have `aria-describedby` for accessibility
- [ ] Updates in real-time as new comments are added

### 8.3 Messaging Manual Tests
- [ ] Contact list shows on left panel
- [ ] Conversation shows on right panel
- [ ] ID Chip fixed at top (doesn't scroll with messages)
- [ ] "Show QR" displays QR code
- [ ] "Copy ID" copies to clipboard with toast feedback
- [ ] Composer always visible without scrolling
- [ ] Last conversation persists on return
- [ ] Messages icon (ğŸ’¬) in navbar opens Messages from any page

### 8.4 User Handle Tests
- [ ] **Onboarding requires handle** â€” Can't proceed without setting handle
- [ ] **Validation** â€” Rejects handles <3 or >20 chars
- [ ] **Validation** â€” Rejects handles with special chars (only alphanumeric + _)
- [ ] **Settings edit** â€” Can change handle in Settings
- [ ] Handle appears in contact exchange QR/copy data
- [ ] Contact list shows peer's handle (not nullifier)
- [ ] **Duplicate handling** â€” Second "Alice" shows as "Alice (2)"
- [ ] Message headers show peer's handle
- [ ] Missing handle (legacy) falls back to truncated nullifier

### 8.5 Regression Tests
- [ ] All existing E2E tests pass
- [ ] All unit tests pass
- [ ] Forum thread persistence still works
- [ ] Comment persistence still works
- [ ] Cross-browser sync still works
- [ ] Message send/receive still works
- [ ] Identity creation still works

### 8.6 E2E Mode Tests (`VITE_E2E_MODE=true`)
- [ ] Card zoom animation works (no network)
- [ ] Card flip animation works (no network)
- [ ] Handle entry/display works with mock store
- [ ] ID Chip QR generation works offline
- [ ] All forum interactions work with mock Gun client
- [ ] All messaging interactions work with mock Gun client

### 8.7 Accessibility Tests
- [ ] Lighthouse A11y score â‰¥ 90
- [ ] Keyboard-only navigation through all flows
- [ ] Screen reader announces zoom/flip state changes
- [ ] Focus visible on all interactive elements
- [ ] Escape key dismisses zoomed card

---

## 9. Notes & Observations

_Space for notes during exploratory testing:_

### Session 1 (Dec 6, 2025)
- **Issue 2.1 identified:** Comment/Counterpoint duplication in ThreadView
- **Issue 2.2 identified:** Need smooth VENN â†’ Forum transition (card flip / swipe)
- **Issue 2.3 identified:** Nested comment zoom pattern â€” click to fill view, swipe/click to go back
- **Issue 3.1 identified:** Messaging layout refinement â€” contacts left, conversation right, ID Chip always visible
- **Issue 3.1a identified:** Messages icon in global navbar for quick access

### Session 1 - Clarifications (Dec 6, 2025)
- **2.3 Zoom:** CSS animation (scale/position/z-index), NOT route change. Dimmed backdrop for dismissal.
- **2.2 Flip:** 3D card flip, but ONLY summary/bias section flips â€” headline stays anchored at top
- **3.1 ID Chip:** Fixed position (always visible). Shows YOUR ID only. Frictionless: Nav â†’ Messages â†’ ID Chip
- **3.2 Handles:** Users need display names (handles). Contacts show handle, not nullifier.

### Session 1 - Additional Clarifications (Dec 6, 2025)
- **3.2 Handle format:** Alphanumeric + underscore, 3-20 chars (like Twitter)
- **3.2 Handle uniqueness:** NOT unique globally. Duplicates allowed. Show discriminator "(2)" only if same handle appears twice in one user's contact list.
- **3.2 When to set:** Required during onboarding, can change in Settings anytime.
- **2.3 Depth indicator:** Stacked cards â€” parent cards show 1px border at top edge (fanned deck). Can click parent edge to zoom back.
- **2.2 Empty thread:** Show "Start the conversation" prompt with inline composer.

### Architecture Review (Dec 6, 2025)
Reviewed against foundational documents (`System_Architecture.md`, `trinity_project_brief.md`, `ARCHITECTURE_LOCK.md`):

**âœ… Aligned:**
- Local-first: Handle stored on-device, shared only via explicit contact exchange
- Privacy: No global handle directory, nullifier remains canonical
- Civic Dignity Loop: UI refinements support engagement â†’ contribution flow
- Browser-safe: Pure CSS animations

**Added constraints (Â§1.1, Â§1.2):**
- 350 LOC cap for new components
- 100% coverage requirement
- E2E mode compatibility
- Accessibility requirements (Lighthouse A11y â‰¥ 90)
- Performance requirements (60fps, CSS-only transforms)

### Major Design Decision: Debate-First Forum Structure (Dec 6, 2025)
**Decision:** Refactor Forum from linear thread to structured **Concur/Counter debate format** at every level.

**Rationale:**
- Mirrors VENN's bias table (Frame vs Reframe) â†’ consistency in civic engagement model
- Eliminates the confusing Comment/Counterpoint duplication issue
- Creates a more structured, deliberative discussion format
- Supports the project's goal of "nuanced sentiment" and "shared reality"

**Schema Change:**
- OLD: `type: 'reply' | 'counterpoint'`
- NEW: `stance: 'concur' | 'counter'`

**UI Change:**
- OLD: Linear thread with counterpoints bolted on
- NEW: Two-column debate layout (Concur | Counter) at every level
- Every comment, when zoomed, reveals its own Concur/Counter columns

### Civic Action Seed: Community Reaction Summary (Dec 7, 2025)
**Decision:** The Community Reaction Summary is both computed metrics AND AI-generated summary, and functions as the **seed for civic action**.

**Key Insight:** Forum discussions aren't just conversations â€” they're constituency data that can be:
1. **Sent to Representatives** â€” Sentiment reports via Sovereign Legislative Bridge
2. **Elevated to Proposals** â€” Draft policy proposals for QF backing
3. **Started as Projects** â€” Community-driven initiatives

**LUMA Integration:**
- Leverage constituency proofs to show per-district breakdown
- Show which % of participants are constituents of which reps
- Enable "Send to Rep" action based on verified constituency

**Privacy Note:** Per-user constituency stays local (LUMA). Only aggregates (e.g., "12 participants from CA-12") are shown. No individual nullifier â†” district mappings exposed.

### Collaborative Review Round 1 (Dec 7, 2025)
**Reviewers:** Codex + Gemini + Claude
**Status:** CONDITIONAL GO

**Key Decisions:**
1. **Schema Migration:** Keep `parentId`, add `stance`, keep `targetId` as deprecated (dual-parse)
2. **Cohort Threshold:** **N=20** (not N=5) per `spec-data-topology-privacy-v0.md`
3. **"Other Districts" Aggregation:** **DEFERRED to Sprint 4** â€” requires Guardian Node
4. **Handles in Directory:** **REMOVED** â€” handles are local-only (QR + ContactRecord)
5. **Action Buttons:** Non-destructive modal (not greyed out) for accessibility
6. **AI Summary:** Local WebLLM, debounced regeneration

**STOP Items (Cut from Sprint 3.5):**
- âŒ Per-district breakdown ("Other Districts") â€” privacy violation without Guardian
- âŒ Handle field in DirectoryEntry â€” would leak to public mesh

**GO Items:**
- âœ… Forum debate structure (Concur/Counter)
- âœ… 3D card flip animation
- âœ… Zoom navigation with stacked cards
- âœ… Handles (local-only, QR exchange)
- âœ… Global metrics + AI summary
- âœ… "Your Contribution" indicator

### Collaborative Review Round 2 (Dec 7, 2025)
**Reviewers:** Codex + Gemini + Claude
**Status:** GO (with minor clarifications applied)

**Clarifications Applied:**
1. **Zod Union:** Added explicit `z.union([v0, v1])` schema documentation and test requirements
2. **Illustrative Diagrams:** Marked per-district counts as illustrative only with test assertion note
3. **AI Debounce:** Set to **45 seconds**, added explicit prompt template excluding PII/handles
4. **Modal Spec:** Added `role="dialog"`, `aria-modal="true"`, focus trap, Escape key requirements
5. **Messaging Spec:** Updated QR payload to include `handle`, added `ContactRecord` priority logic
6. **DirectoryEntry:** Confirmed unchanged â€” explicit note that `handle` is NOT added

**Final Status:** All reviewers approved. Ready for developer handoff.

### Phase 1 Implementation (Dec 7, 2025)

**Implemented by Codex:**

1. **Schema Migration (v0 â†’ v1):**
   - `HermesCommentSchemaV0` (deprecated, read-only)
   - `HermesCommentSchemaV1` with `stance: 'concur' | 'counter'`
   - `HermesCommentSchema = z.union([V0, V1])` for backward-compatible reads
   - `HermesCommentWriteSchema` (v1 only, strict)
   - `migrateCommentToV1()` helper function

2. **Store Updates:**
   - `getCommentsByStance(threadId, stance)` selector
   - `getConcurComments(threadId)` convenience selector
   - `getCounterComments(threadId)` convenience selector
   - Mock store updated with stance support

3. **UI Components:**
   - `CommentCard.tsx` (105 lines) â€” Clickable card with nested Concur/Counter
   - `DebateColumn.tsx` (51 lines) â€” Renders comments by stance with add toggle
   - `ZoomableCard.tsx` (67 lines) â€” Zoom overlay with backdrop and breadcrumb
   - `ThreadView.tsx` refactored â€” Debate-first layout with root-level columns

4. **Navigation Hook:**
   - `useZoomNavigation.ts` (31 lines) â€” Stack-based zoom with Escape handling
   - `useZoomNavigation.test.ts` (17 tests) â€” Full coverage

**Test Summary:**
- **275 tests passing** (up from 250)
- **100% statement coverage**
- **100% branch coverage**
- **100% function coverage**
- **100% line coverage**

---

## 10. Exit Criteria

### 10.1 Functional
- [ ] All identified issues resolved
- [ ] No visual regressions
- [ ] Manual verification complete

### 10.2 Engineering Discipline (Non-Negotiable)
- [x] **LOC Cap:** All new files under 350 lines âœ… (max 105 lines)
- [x] **Coverage:** 100% Line/Branch for new/modified code âœ… (100%/100%/100%/100%)
- [ ] **E2E Mode:** All features work with `VITE_E2E_MODE=true`
- [ ] **Accessibility:** Lighthouse A11y â‰¥ 90
- [ ] **Performance:** No animation jank (60fps), CSS-only transforms

### 10.3 Testing
- [x] All existing unit tests pass âœ… (275 tests)
- [ ] All existing E2E tests pass
- [x] New component tests written and passing âœ…
- [ ] Manual test checklist complete (Â§8)

### 10.4 Ready for Sprint 4
- [ ] Sprint 3.5 doc marked complete
- [ ] No blocking issues remaining

### 10.5 Phase 1 Exit Criteria (ACHIEVED Dec 7, 2025)
- [x] Schema v1 implemented with backward-compatible reads
- [x] Store selectors for debate layout
- [x] UI components for debate-first forum
- [x] Zoom navigation with Escape handling
- [x] 100% test coverage maintained

