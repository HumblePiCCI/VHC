# Sprint 3.5: UI/UX Refinement â€” Implementation Details (Archive)

**Status:** âœ… **COMPLETE** | **Dates:** Dec 6-18, 2025
**Goal:** Polish HERMES Messaging + Forum UI/UX before Sprint 4 (Agentic Foundation)

> ğŸ“„ **Summary:** [03.5-sprint-3.5-ui-refinement.md](../../03.5-sprint-3.5-ui-refinement.md)
> ğŸ¨ **Color Panel:** [dev-color-panel.md](../../dev-color-panel.md)

---

## 1. Guiding Principles

1. **Polish Over Features:** No new functionality â€” refinement only
2. **User-Driven:** Issues from real usage testing
3. **Light Touch:** Minimal code, maximum UX impact
4. **No Regressions:** All existing tests must pass

### 1.1 Engineering Discipline (`ARCHITECTURE_LOCK.md`)

- [x] **LOC Cap:** 350 lines/file âœ… (max 346 lines â€” CommentStream.tsx)
- [x] **Coverage:** 100% Line/Branch/Function/Statement âœ… (335 tests)
- [x] **Browser-Safe:** No `node:*` imports, CSS-only animations âœ…
- [x] **E2E Mode:** Works with `VITE_E2E_MODE=true` âœ…
- [ ] **Accessibility:** Lighthouse A11y â‰¥ 90

### 1.2 Privacy Alignment (`System_Architecture.md`)

**Handles:** Local-first, opt-in sharing via QR/copy, NOT in public directory
**Constituency:** Per-user proofs stay local; only global aggregates shown; **N=20** cohort threshold
**"Other Districts":** **DEFERRED to Sprint 5** (requires Guardian Node)

---

## 2. Forum UI Refinements

### 2.1 Debate-First Layout (Schema v1)

**Problem:** Linear thread with counterpoints bolted on creates duplication
**Solution:** **Concur/Counter columns** as primary layout at every level

**Schema Change:**
```typescript
// HermesCommentSchemaV1
stance: 'concur' | 'counter';  // NEW - every comment has a stance
type?: 'reply' | 'counterpoint';  // DEPRECATED (read-only for migration)
```

**Migration:** `z.union([V0, V1])` for reads; write only V1

**Files:** `packages/data-model/src/schemas/hermes/forum.ts`, `apps/web-pwa/src/store/forum/*`

### 2.2 VENN â†’ Forum Transition (3D Card Flip)

**Vision:** Article summary flips to reveal debate discussion. Headline stays anchored.

<details>
<summary>ğŸ“ Layout Diagrams (click to expand)</summary>

```
VENN Article View (FRONT)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Headline: "Climate Bill Passes Senate"                       â”‚ â† STAYS FIXED
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚   ARTICLE SUMMARY + BIAS TABLE                           â”‚ â”‚
â”‚ â”‚   [Frame: "Historic victory"] [Reframe: "Insufficient"]  â”‚ â”‚ â† FLIPS
â”‚ â”‚   [ğŸ’¬ Discuss in Forum]                                  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“ 3D Card Flip â†“
Forum Discussion View (BACK)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Headline: "Climate Bill Passes Senate"                       â”‚ â† SAME
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚   COMMUNITY REACTION SUMMARY                             â”‚ â”‚
â”‚ â”‚   47 participants â€¢ 23 Concur, 24 Counter                â”‚ â”‚
â”‚ â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚ â”‚   â”‚ ğŸ‘ CONCUR (23)      â”‚ ğŸ‘ COUNTER (24)             â”‚  â”‚ â”‚
â”‚ â”‚   â”‚ [comment cards]     â”‚ [comment cards]             â”‚  â”‚ â”‚
â”‚ â”‚   â”‚ [+ Add Concur]      â”‚ [+ Add Counter]             â”‚  â”‚ â”‚
â”‚ â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚ â”‚   [â† Back to Analysis]                                   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Zoomed Comment (nested debate within):**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ (dimmed backdrop â€” click to dismiss) â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â”‚
â”‚â–‘â–‘â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â–‘â–‘â”‚
â”‚â–‘â–‘â”‚  @alice â€¢ "Finally, logic prevails!"         [â–²12 â–¼]  â”‚â–‘â–‘â”‚
â”‚â–‘â–‘â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â–‘â–‘â”‚
â”‚â–‘â–‘â”‚  â”‚ ğŸ‘ CONCUR (8)    â”‚ ğŸ‘ COUNTER (4)                â”‚â”‚â–‘â–‘â”‚
â”‚â–‘â–‘â”‚  â”‚ [nested cards]   â”‚ [nested cards]                â”‚â”‚â–‘â–‘â”‚
â”‚â–‘â–‘â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â–‘â–‘â”‚
â”‚â–‘â–‘â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â–‘â–‘â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Stacked cards breadcrumb (3 levels deep):**
```
â”‚â–‘â–‘â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â–‘â–‘â”‚ â† Level 0
â”‚â–‘â–‘â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â–‘â–‘â”‚ â† Level 1
â”‚â–‘â–‘â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â–‘â–‘â”‚ â† Level 2
â”‚â–‘â–‘â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â–‘â–‘â”‚ â† Current (Level 3)
```

</details>

**Community Reaction Summary Components:**
1. **Global Metrics:** Participant count, Concur/Counter breakdown
2. **Your Contribution:** "You participated (Concur/Counter)" indicator
3. **AI Summary:** Local WebLLM synthesis (45s debounce + manual refresh)
4. **Action Buttons:** "Send to Rep", "Draft Proposal", "Start Project" â†’ modal "Coming in Sprint 5"
5. **District:** Placeholder with lock icon (DEFERRED)

**Files:** `FlippableCard.tsx`, `AnalysisView.tsx`, `CommunityReactionSummary.tsx`

### 2.3 Zoom Navigation

**Behavior:** Click comment â†’ CSS scale/z-index animation â†’ fills width â†’ shows nested Concur/Counter
- **Escape:** Zoom out one level
- **Backdrop click:** Return to root
- **Parent edge click:** Return to that level
- **Pills:** Collapsed comments show "ğŸ‘ 3 Concur" pills; expanded shows full columns

**Files:** `ZoomableCard.tsx`, `CommentCard.tsx`, `useZoomNavigation.ts`

---

## 3. Messaging UI Refinements

### 3.1 Layout & ID Chip
- Contact list left, conversation right
- **ID Chip:** Fixed at top, shows YOUR ID (QR/Copy)
- **Navbar icon:** ğŸ’¬ accessible from any page â†’ `/hermes/messages`

### 3.2 User Handles
- **Format:** Alphanumeric + underscore, 3-20 chars
- **Uniqueness:** Not enforced; duplicates show discriminator "(2)"
- **Privacy:** NOT in DirectoryEntry; only in QR/copy payload + local ContactRecord
- **Display:** `handle ?? displayName ?? truncated(nullifier)`

**Files:** `IDChip.tsx`, `ChannelList.tsx`, `useIdentity.ts`, `utils/handle.ts`

---

## 4. Routes (Simplified)

| Route | Content |
|-------|---------|
| `/hermes` | Forum feed (direct access) |
| `/hermes/$threadId` | Individual thread |
| `/hermes/messages` | Messages (via ğŸ’¬ icon) |

---

## 5. Accessibility & Performance

- [x] CSS-only animations (transform, opacity) â†’ 60fps âœ…
- [x] `prefers-reduced-motion` respected âœ…
- [x] `aria-expanded`, `aria-hidden`, `role="dialog"` on flip/zoom âœ…
- [x] Focus trap in modals, Escape key dismissal âœ…
- [ ] Lighthouse A11y â‰¥ 90

---

## 6. Implementation Summary

| Phase | Description | Status |
|-------|-------------|--------|
| 1 | Schema v1 (stance), Store selectors, Debate UI, Zoom hook | âœ… |
| 2a | User Handles, IDChip | âœ… |
| 2b | Navbar ğŸ’¬, Community Reaction Summary | âœ… |
| 3 | FlippableCard 3D animation | âœ… |
| 4 | Manual testing bug fixes | âœ… |
| 5 | CI & E2E fixes | âœ… |
| 6 | Design Unification (borderless, themes, 3D flip) | âœ… |
| 6.1 | Visual Refinements (Heroicons, glow system, nested summary) | âœ… |
| 6.2 | Dev Color Panel (43 CSS vars, sliders, save to defaults) | âœ… |
| 6.3 | ThreadView Consolidation (unified card, auto-summary) | âœ… |
| 7.0 | Schema Update (tri-state stance: concur/counter/discuss) | âœ… |
| 7.1 | CommentStream (threaded tree, SlideToPost, stance connectors) | âœ… |

**Test Status:** 335 unit + 10 E2E passing | 100% coverage | CI green âœ…

<details>
<summary>ğŸ“‹ Phase Implementation Details (click to expand)</summary>

### Phase 1: Schema & Debate Layout (Dec 7)
- `HermesCommentSchemaV0` (deprecated) + `HermesCommentSchemaV1` (current)
- `z.union([V0, V1])` for reads, write only V1
- `migrateCommentToV1()` helper
- `getConcurComments()`, `getCounterComments()` selectors
- `CommentCard.tsx` (105 LOC), `DebateColumn.tsx` (51 LOC), `ZoomableCard.tsx` (67 LOC)
- `useZoomNavigation.ts` (31 LOC, 17 tests)

### Phase 2a: Handles & IDChip (Dec 7)
- `utils/handle.ts` â€” `isValidHandle()`, `getHandleError()`
- `useIdentity.ts` â€” handle field + `updateHandle()`
- `IDChip.tsx` (71 LOC) â€” replaces ContactQR
- `HandleEditor.tsx` (55 LOC) â€” extracted for LOC compliance

### Phase 2b: Navbar & Summary (Dec 7)
- ğŸ’¬ in header â†’ `/hermes/messages`
- `CommunityReactionSummary.tsx` (212 LOC)
- AI summary with 45s debounce + manual refresh
- Action button modals with a11y

### Phase 3: FlippableCard (Dec 7)
- `FlippableCard.tsx` (72 LOC)
- CSS `rotateY(180deg)`, `perspective: 1000px`
- `AnalysisView.tsx` integration

### Phase 4: Bug Fixes (Dec 7)
- **Infinite loop:** Added `subscribedThreads` Set to prevent duplicate subscriptions
- **Selector stability:** Use `EMPTY_COMMENTS` constant instead of `?? []`
- **Comment posting:** Always call `createComment()` before `onSubmit()`
- **Multi-zoom:** Only trigger `onSelect` when `!isExpanded`
- **Pills:** Show count pills collapsed, full content expanded
- **Navigation:** Forum loads at `/hermes` directly

### Phase 5: CI/E2E (Dec 7)
- Added `@vh/ai-engine` alias to `vitest.config.ts`
- Updated E2E tests: handle field, route changes, IDChip testids

</details>

---

## 7. Testing Checklist

### Forum
- [x] Two columns (Concur/Counter) display âœ…
- [x] Community Summary shows metrics âœ…
- [x] Zoom fills width, shows nested debate âœ…
- [x] Stacked cards breadcrumb âœ…
- [x] 3D flip VENN â†’ Forum âœ…
- [x] Add comments from zoomed view âœ…
- [ ] Vote persistence

### Messaging
- [x] ID Chip fixed at top âœ…
- [x] ğŸ’¬ navbar icon âœ…
- [x] Handle display with discriminators âœ…

### Regression
- [x] 335 unit tests âœ…
- [x] 10 E2E tests âœ…
- [x] 100% coverage âœ…

---

## 8. Key Decisions Log

| Decision | Rationale |
|----------|-----------|
| `stance` replaces `type` | Mirrors VENN bias table; eliminates duplication |
| N=20 cohort threshold | Per `docs/specs/spec-data-topology-privacy-v0.md` |
| "Other Districts" deferred | Requires Guardian Node for privacy |
| Handles NOT in directory | Privacy: local-only, QR exchange |
| Action buttons â†’ modal | Accessibility > disabled buttons |
| 45s AI debounce | Prevent thrashing local WebLLM |

<details>
<summary>ğŸ“ Session Notes Archive (click to expand)</summary>

### Session 1 (Dec 6)
- Issue 2.1: Comment/Counterpoint duplication â†’ debate-first layout
- Issue 2.2: Need VENN â†’ Forum transition â†’ 3D flip
- Issue 2.3: Nested zoom pattern â†’ CSS animation + backdrop
- Issue 3.1: Messaging layout â†’ contacts left, ID Chip fixed
- Issue 3.2: Need handles â†’ alphanumeric 3-20 chars

### Review Rounds (Dec 7)
**Round 1 (Codex + Gemini):** CONDITIONAL GO
- Cut: "Other Districts", handle in directory
- Keep: Debate layout, flip, zoom, handles (local), global metrics

**Round 2:** GO â€” all concerns addressed

### Manual Testing (Dec 7)
Issues found & fixed:
1. Infinite loop (subscription duplication)
2. Comments not appearing (onSubmit bypassed createComment)
3. Multi-zoom not working (expanded card re-zooming)
4. Needed pills for collapsed state
5. Navigation too cluttered â†’ simplified routes

</details>

### Additional Fixes (Dec 7, Session 2)

| Issue | Root Cause | Fix |
|-------|------------|-----|
| "Add Counter" button invisible | `variant="ghost"` on dark bg | Solid colored button (amber/teal) |
| Expanded HeadlineCard not interactive | Click bubbled to parent, collapsed card | `e.stopPropagation()` on expanded content |
| FlippableCard content clipped/not scrollable | `position: absolute` with `minHeight: 200px` | Conditional rendering instead of stacked absolute |
| Duplicate React keys in FeedList | Pagination reset on refresh, corrupted cache | Bumped cache key `v2`, added `dedupeItems()` helper |

**Files modified:** `DebateColumn.tsx`, `HeadlineCard.tsx`, `FlippableCard.tsx`, `useFeedStore.ts`

---

## 10. Phase 6: Design Unification (Dec 8, 2025)

**Status:** âœ… COMPLETE (Dec 10, 2025)

### 10.1 Vision

Unify VENN and HERMES into a **clean, cohesive two-sided card system**:
- **VENN (Front):** News analysis, sentiment capture â€” soft pastel green lean
- **HERMES (Back):** Community voice, discussion â€” warm rusty lean
- **Same card, different concerns, connected but separate**

### 10.2 Design Philosophy: Borderless

**No hard borders anywhere.** All visual separation via:
- Subtle hue/value shifts between layers
- Soft drop shadows (`shadow-sm`, `shadow-md`)
- Color temperature shifts (cool for positive, warm for negative)

This applies to: cards, columns, buttons, nested elements.

### 10.3 Color Theme

| Element | Direction |
|---------|-----------|
| **VENN side** | Slate base + pastel green undertones (`emerald-50/100` tints) |
| **HERMES side** | Slate base + warm rust undertones (`amber-900`, `orange-950` tints) |
| **Concur column** | Cool shift (teal/blue) |
| **Counter column** | Warm shift (amber/orange) |

### 10.4 Card Structure

```
VENN SIDE (Front) â€” Pastel Green Lean
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                          ğŸ‘ï¸ 12.3   ğŸ’¡ 1.6  â”‚ â† metrics (small, top-right)
â”‚                                                             â”‚
â”‚  Article Headline                                           â”‚
â”‚  Summary text...                                            â”‚
â”‚                                                             â”‚
â”‚  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  â”‚ â† hue shift (no border)
â”‚                                                             â”‚
â”‚  Perspectives (Frame / Reframe)                             â”‚
â”‚  [+] [-]  |  [+] [-]                                        â”‚
â”‚                                                             â”‚
â”‚  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  â”‚
â”‚                                                             â”‚
â”‚  [ğŸ’¬ Discuss in Forum]  â† borderless button, shadow only    â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    â†» 3D Flip Animation â†»

HERMES SIDE (Back) â€” Warm Rusty Lean
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                          ğŸ‘ï¸ 12.3   ğŸ’¡ 1.6  â”‚ â† same metrics position
â”‚                                                             â”‚
â”‚  Thread Title                                               â”‚
â”‚  Post content (lede if from article, or user-written)       â”‚
â”‚                                                             â”‚
â”‚  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  â”‚ â† hue shift
â”‚                                                             â”‚
â”‚  Conversation Summary                                       â”‚
â”‚  "AI-generated synthesis of the discussion..."              â”‚
â”‚                                                             â”‚
â”‚  [ğŸ“¤] [ğŸ“] [ğŸŒ±]  â† line icons, greyed until threshold       â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ Concur (cool)       â”‚  â”‚ Counter (warm)      â”‚          â”‚ â† nested cards
â”‚  â”‚ teal shift          â”‚  â”‚ amber shift         â”‚          â”‚    shadow separation
â”‚  â”‚ shadow only         â”‚  â”‚ shadow only         â”‚          â”‚    NO borders
â”‚  â”‚                     â”‚  â”‚                     â”‚          â”‚
â”‚  â”‚ [+ Add Concur]      â”‚  â”‚ [+ Add Counter]     â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                             â”‚
â”‚  [â† Back to Analysis]  â† footer position                    â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10.5 UI Changes from Current

| Current | New |
|---------|-----|
| "1 participant â€¢ 2 Concur, 1 Counter" text | **Removed** (data kept in store for reports) |
| Bordered cards/columns | **Borderless** â€” hue shifts + shadows |
| Solid colored buttons | **Borderless buttons** â€” subtle bg shift + shadow |
| Action buttons open modal | **Line icons** (ğŸ“¤ğŸ“ğŸŒ±) greyed until thresholds |
| FlippableCard (conditional render) | **Restore 3D flip** with proper height handling |

### 10.6 Action Icons

| Action | Icon | Style |
|--------|------|-------|
| Send to Rep | `<EnvelopeIcon />` | Line drawing (Heroicons outline) |
| Draft Proposal | `<DocumentIcon />` | Line drawing |
| Start Project | `<SeedlingIcon />` | Line drawing (ğŸŒ± â€” growth metaphor) |

**Behavior:** Greyed/disabled until engagement thresholds met (thresholds TBD).

### 10.7 Data Retained (Hidden from UI)

For Sprint 5 Bridge sentiment reports:
- Participant count
- Concur/Counter breakdown
- Regional constituency data (LUMA)

This data powers action icon thresholds and seeds sentiment reports.

### 10.8 Implementation Plan

| Task | Component | Description |
|------|-----------|-------------|
| 1 | Surface tokens | Add `surface-*` utility classes in Tailwind config |
| 2 | `FlippableCard` | CSS Grid stacking + 3D flip (no JS height) |
| 3 | `AnalysisView` | Apply `surface-venn`, metrics top-right |
| 4 | `ThreadView` | Apply `surface-hermes`, remove text counts |
| 5 | `DebateColumn` | `surface-concur` / `surface-counter`, borderless |
| 6 | `CommunityReactionSummary` | Clean layout, line icons (Heroicons outline) |
| 7 | `CommentCard` | Borderless nested styling with focus rings |
| 8 | Buttons | Borderless variant with shadow + focus ring |

**Scope Guard:** Dense lists (`ChannelList`) retain borders for readability.

### 10.9 Not Yet Defined

- Exact threshold numbers for action icon unlock
- Mobile layout (vertical stack + horizontal scroll â€” deferred)
- Specific icon SVGs (will use Heroicons outline set)

### 10.10 Review Feedback (Dec 8, 2025)

**Reviewers:** Codex + Gemini | **Verdict:** âœ… GO

#### Recommendations Incorporated

| Feedback | Source | Resolution |
|----------|--------|------------|
| Use "surface" design tokens | Codex | Add `surface-venn`, `surface-hermes` utility classes |
| CSS Grid stacking for flip | Gemini | Use `display: grid; grid-area: 1/1` â€” no JS height calc |
| Hue shifts primary, shadows secondary | Both | Adjust approach â€” bg delta first, shadow decorative |
| Keep borders for dense lists | Codex | ChannelList retains borders for readability |
| Focus rings for keyboard a11y | Codex | Ensure `focus-visible:ring-*` on all interactive elements |
| No PII in AI prompts | Codex | Already compliant (handles/nullifiers excluded) |
| Regional = local user or global only | Gemini | Already compliant per Â§1.2 |

#### Technical Approach Updates

**FlippableCard (CSS Grid):**
```css
.flip-container {
  display: grid;
  perspective: 1000px;
}
.flip-front, .flip-back {
  grid-area: 1 / 1;
  backface-visibility: hidden;
  transition: transform 0.6s ease-in-out;
}
.flip-back { transform: rotateY(180deg); }
.flipped .flip-front { transform: rotateY(-180deg); }
.flipped .flip-back { transform: rotateY(0deg); }
```
*Container auto-sizes to tallest face. No JS height calculation.*

**Surface Tokens:**
```css
.surface-base { @apply bg-slate-900 shadow-sm; }
.surface-venn { @apply bg-emerald-950/30 shadow-md; }
.surface-hermes { @apply bg-amber-950/30 shadow-md; }
.surface-concur { @apply bg-teal-900/20 shadow-sm; }
.surface-counter { @apply bg-orange-900/20 shadow-sm; }
```

**A11y Compliance:**
- Primary separation: Background color delta (e.g., `slate-900` vs `slate-800`)
- Secondary: Drop shadow for depth perception
- Focus: `focus-visible:ring-2 focus-visible:ring-offset-2` on all buttons
- Contrast: Text maintains 4.5:1 ratio against surface backgrounds

### 10.11 Phase 6.1: Manual Testing Refinements (Dec 8, 2025)

**Status:** âœ… COMPLETE (Dec 10, 2025)

#### Visual Cleanup Goals

UI is still too busy. Refinements to simplify and unify:

#### 1. Conversation Summary â€” Nested Card

Place summary inside a **lighter nested card** within the main thread card:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                          ğŸ‘ï¸ 12  ğŸ’¡ 1.6     â”‚ â† TOP-RIGHT
â”‚                                                             â”‚
â”‚  Thread Title                                               â”‚
â”‚  Post content...                                            â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Conversation Summary                                  â”‚  â”‚ â† lighter nested card
â”‚  â”‚ "AI summary text..."                    (font-light)  â”‚  â”‚ â† lighter font weight
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â”‚ [ğŸ“¤] [ğŸ“] [ğŸ§ª]  â† icons only, tooltip on hover        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â”‚  [Concur] [Counter] columns...                              â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2. Engagement Icons â€” Glow System

**Position:** Top-right of every card (thread, expanded comment)

| State | Icon | Effect |
|-------|------|--------|
| **Unengaged** | Heroicons **outline** | Muted color, no glow |
| **Engaged** | Heroicons **solid** | White haze glow |

**Glow CSS:**
```css
.icon-glow {
  filter: drop-shadow(0 0 6px rgba(255, 255, 255, 0.7));
}
```

**Eye (viewed) triggers:**
- Card expanded/viewed for **5+ seconds**
- User scrolled through content (any scroll)

**Lightbulb (engaged) triggers:**
- Voted on content
- Posted a comment
- Uses **decay formula:** `E_new = E_current + 0.3 * (2.0 - E_current)`
- Full engagement for comment, falloff for parent thread

**Removed:** "âœ… You participated (stance)" text â€” replaced by icon glow state

#### 3. Nested Comment Engagement

When a comment is expanded (zoomed), show its own engagement icons:

```
Collapsed:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ @alice: "Finally, logic!"             â”‚
â”‚ ğŸ‘ 3 Concur  ğŸ‘ 1 Counter             â”‚ â† pills only
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Expanded (zoomed):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                        ğŸ‘ï¸ 8  ğŸ’¡ 0.4      â”‚ â† THIS comment's engagement
â”‚                                                           â”‚
â”‚ @alice: "Finally, logic prevails!"                        â”‚
â”‚ Full content...                                           â”‚
â”‚                                                           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚ â”‚ Concur (3)      â”‚  â”‚ Counter (1)     â”‚                  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4. Action Icons â€” Tooltip Only

**Remove text labels.** Icons only, with `title` tooltip on hover:

| Action | Icon | Tooltip |
|--------|------|---------|
| Send to Rep | `EnvelopeIcon` | "Send to Rep" |
| Draft Proposal | `DocumentTextIcon` | "Draft Proposal" |
| Start Project | `BeakerIcon` | "Start Project" |

**Note:** Changed from SparklesIcon â†’ **BeakerIcon** for "Start Project"

#### 5. Light Mode Theming

| Side | Dark Mode | Light Mode |
|------|-----------|------------|
| VENN | `emerald-950/30` | `emerald-100/50` (bright pastel green) |
| HERMES | `amber-950/30` | `orange-100/50` (bright pastel rust) |

**Glow in light mode:** Try white first. If insufficient contrast, add darker enclosing circles around icons.

#### 6. Site-Wide Icon Consistency

**All icons:** Heroicons **outline** everywhere
**Exception:** Eye/Lightbulb become **solid** + glow when engaged

#### Implementation Tasks

| Task | Component | Description | Status |
|------|-----------|-------------|--------|
| 1 | `useViewTracking` | Hook: 5s timer + scroll detection â†’ calls `recordRead` | âœ… |
| 2 | `EngagementIcons` | Component: outline/solid + glow (drop-shadow) | âœ… |
| 3 | `ThreadView` | Use `useViewTracking`, icons top-right | âœ… |
| 4 | `CommentCard` | Show engagement icons when `isExpanded` | âœ… |
| 5 | `CommunityReactionSummary` | Nested card, lighter font, icons with `aria-label` | âœ… |
| 6 | Action icons | BeakerIcon, `aria-label` + `title`, keyboard handlers | âœ… |
| 7 | Surface tokens | Light mode variants via CSS variables | âœ… |
| 8 | Icon shadow | Drop shadow behind glow for edge definition | âœ… |

#### Review Feedback Incorporated (Dec 8, 2025)

**From Codex + Gemini:**

| Topic | Recommendation | Resolution |
|-------|----------------|------------|
| **Integration** | Use existing `recordRead` in `useSentimentState` | âœ… No new store shape needed |
| **View hook** | Create `useViewTracking` with IntersectionObserver + 5s timer | âœ… Keeps components clean |
| **Accessibility** | `title` alone insufficient â€” MUST use `aria-label` | âœ… Add `aria-label` to all icon buttons |
| **Performance** | `filter: drop-shadow()` expensive â†’ use `box-shadow` instead | âœ… Pseudo-element with `box-shadow` |
| **Reduced motion** | Disable pulsing/animated glows | âœ… Check `prefers-reduced-motion` |
| **Decay** | Keep in `useSentimentState` â€” already implemented (lines 52-54) | âœ… Reuse existing decay formula |
| **Scope** | Achievable (~1 day) | âœ… Proceed |

#### Updated Technical Approach

**useViewTracking Hook:**
```typescript
// apps/web-pwa/src/hooks/useViewTracking.ts
export function useViewTracking(itemId: string, onRead: (id: string) => void) {
  const [hasViewed, setHasViewed] = useState(false);
  const hasScrolledRef = useRef(false);
  const timerRef = useRef<number | null>(null);

  useEffect(() => {
    // Start 5s timer
    timerRef.current = window.setTimeout(() => {
      if (hasScrolledRef.current) {
        setHasViewed(true);
        onRead(itemId);
      }
    }, 5000);

    const handleScroll = () => { hasScrolledRef.current = true; };
    window.addEventListener('scroll', handleScroll, { passive: true });

    return () => {
      if (timerRef.current) clearTimeout(timerRef.current);
      window.removeEventListener('scroll', handleScroll);
    };
  }, [itemId, onRead]);

  return hasViewed;
}
```

**Glow Effect (box-shadow, not filter):**
```css
/* Prefer box-shadow for GPU performance */
.icon-glow {
  position: relative;
}
.icon-glow::before {
  content: '';
  position: absolute;
  inset: -4px;
  border-radius: 9999px;
  background: rgba(255, 255, 255, 0.3);
  filter: blur(6px);
  z-index: -1;
}
/* Respect reduced motion */
@media (prefers-reduced-motion: reduce) {
  .icon-glow::before { display: none; }
}
```

**Accessible Icon Buttons:**
```tsx
<button 
  aria-label="Start Project" 
  title="Start Project"
  tabIndex={0}
  onKeyDown={(e) => { if (e.key === 'Enter' || e.key === ' ') onClick(); }}
  className="focus-visible:ring-2 ..."
>
  <BeakerIcon className="h-5 w-5" />
</button>
```

#### Files to Modify

```
apps/web-pwa/
â”œâ”€â”€ tailwind.config.cjs                    # Light mode tokens (optional)
â”œâ”€â”€ src/hooks/
â”‚   â”œâ”€â”€ useViewTracking.ts                 # NEW: 5s + scroll â†’ recordRead
â”‚   â””â”€â”€ useSentimentState.ts               # Reuse existing recordRead/decay
â”œâ”€â”€ src/components/
â”‚   â”œâ”€â”€ EngagementIcons.tsx                # NEW: outline/solid + box-shadow glow
â”‚   â”œâ”€â”€ AnalysisView.tsx                   # Icons top-right
â”‚   â””â”€â”€ hermes/
â”‚       â”œâ”€â”€ forum/ThreadView.tsx           # useViewTracking, icons top-right
â”‚       â”œâ”€â”€ CommentCard.tsx                # Show icons when isExpanded
â”‚       â””â”€â”€ CommunityReactionSummary.tsx   # Nested card, aria-label icons
```

---

## 11. Exit Criteria

**Phases 1-5 (Complete):**
- [x] All issues resolved âœ…
- [x] LOC cap maintained (max 212) âœ…
- [x] 100% coverage âœ…
- [x] E2E mode works âœ…
- [x] Manual tests pass âœ…
- [x] CI green âœ…

**Phase 6 (Complete):**
- [x] Design unification implemented âœ…
- [x] Borderless styling applied âœ…
- [x] 3D flip with CSS Grid âœ…
- [x] Surface tokens âœ…
- [x] Tests passing (291), 100% coverage âœ…

**Phase 6.1 (Complete â€” Manual Testing Refinements):**
- [x] Conversation summary â†’ nested card, lighter font âœ…
- [x] Engagement icons â†’ glow system (outline/solid) âœ…
- [x] Action icons â†’ tooltip only, BeakerIcon âœ…
- [x] View tracking (5s + scroll) âœ…
- [x] All Heroicons (EyeIcon, LightBulbIcon, BeakerIcon, etc.) âœ…

**Phase 6.2 (Complete â€” Dev Color Panel):**
- [x] Created comprehensive DevColorPanel component âœ…
- [x] **57 CSS variables** for complete color control âœ…
- [x] Separate page backgrounds for VENN/HERMES/AGORA âœ…
- [x] **Section containers** (Headlines/Forum wrapper) controllable âœ…
- [x] All components wired to CSS variables âœ…
- [x] **Saturation, Lightness, Opacity sliders** per color âœ…
- [x] Thread list cards (forum feed) fully controllable âœ…
- [x] Icon shadow behind glow for edge definition âœ…
- [x] Export CSS to clipboard feature âœ…
- [x] **ğŸ’¾ Save as Default** â€” copies Tailwind config to clipboard âœ…
- [x] localStorage persistence âœ…
- [x] Category tabs for organization âœ…
- [x] 296 tests, 100% coverage âœ…

**Phase 6.3 (Complete â€” ThreadView Consolidation, Dec 11, 2025):**
- [x] 3D flip card visibility fix â€” hidden face no longer bleeds through transparent backgrounds âœ…
- [x] Forum engagement wiring â€” `recordEngagement(topicId)` method added to useSentimentState âœ…
- [x] Forum votes/comments now trigger lightbulb engagement icon âœ…
- [x] Comment form auto-closes after posting âœ…
- [x] Comments appear in real-time (fixed array mutation bug in `addComment`) âœ…
- [x] Removed "Refresh Summary" button â€” auto-generation at thresholds (10, 20, 40, 60...) âœ…
- [x] Unified ThreadView to single card â€” thread header + summary + debate columns âœ…
- [x] Action icons (Send/Proposal/Project) moved inside summary card âœ…
- [x] Debate columns (Concur/Counter) moved inside summary card âœ…
- [x] Smooth zoom-in animation on ThreadView entry (respects `prefers-reduced-motion`) âœ…
- [x] 298 tests, 100% line/branch/function/statement coverage âœ…

**Phase 7.0 (Complete â€” Tri-State Stance Schema, Dec 12, 2025):**
- [x] Schema updated: `stance: 'concur' | 'counter' | 'discuss'` âœ…
- [x] "Discuss" stance for neutral/questioning comments âœ…
- [x] AI summary prompt updated to include discuss comments âœ…
- [x] Concur/Counter percentages exclude discuss (debate clarity) âœ…

**Phase 7.1 (Complete â€” Threaded CommentStream + SlideToPost, Dec 12-18, 2025):**
- [x] Replaced bifurcated Concur/Counter columns with single `CommentStream` âœ…
- [x] Stance is metadata (badge + border color), not layout structure âœ…
- [x] **Tree Connectors:** Stance-based visual alignment:
  - Support (concur): Left-aligned, connectors on left edge
  - Discuss: Left-aligned with tighter 11px branch (vs 28px for support/oppose)
  - Oppose (counter): Right-aligned, connectors on right edge
- [x] Card border radius matches connector side (rounded-r/l/full) âœ…
- [x] Progressive width reduction: 92% â†’ 90% â†’ 88% â†’ 85% (capped at depth 3+) âœ…
- [x] Universal collapse/expand for all comment branches âœ…
- [x] Depth â‰¥3 auto-collapses by default (with userToggled guard) âœ…
- [x] **Tree Connector Refinements (Dec 18):**
  - **YouTube-style trunk termination:** Trunk ends at last child on each side (no overshoot)
  - **Double-curve for discuss:** When discuss comment's desired trunk offset differs from parent, draws step-in curve (outer â†’ inner â†’ card)
  - **Per-row trunk segments:** CSS div trunks render per-row with smart termination
  - **Seamless SVG connections:** BranchConnector draws from y=-2 with overflow-visible for perfect overlap
  - **Split trunk for step curves:** When child needs step, trunk splits into two segments around step region
  - **Separate curve radii:** `stepRadius` vs `branchRadius` for tighter double-curves in constrained space
- [x] **SlideToPost** component â€” single gesture submission:
  - Gradient track (Support â† Discuss â†’ Oppose)
  - Thumb starts centered ("Slide to Post")
  - Drag determines stance (0-30% concur, 31-69% discuss, 70-100% counter)
  - Release commits post
  - Dynamic labels: "Strong Support", "Support", "Discuss", "Oppose", "Strong Oppose"
  - Keyboard accessible (Arrow keys + Enter)
  - `prefers-reduced-motion` respected
  - Success feedback: "âœ“ Posted!" with 1.2s reset
- [x] Reply button wrapped in TrustGate âœ…
- [x] Deleted `DebateColumn.tsx` (replaced by CommentStream) âœ…
- [x] **DevColorPanel** updated:
  - New "Forum Stream" tab with `--stream-*` variables
  - Stance tab renamed (Support/Oppose/Discuss) with new vars
  - Improved rgb/rgba parsing (space-separated support)
  - 57 total CSS variables
- [x] **LOC Refactor (Dec 18):**
  - Extracted `treeConnectors.tsx` (90 lines) â€” constants, helpers, BranchConnector
  - Extracted `VoteControl.tsx` (41 lines) â€” voting UI component
  - Extracted `commentStreamLayout.tsx` (25 lines) â€” cardMaxWidth, stanceMeta, ChildrenContainer
  - Added `treeConnectors.test.tsx` (6 tests) + `VoteControl.test.tsx` (5 tests)
  - `CommentStream.tsx` now 346 lines (under 350 cap)
- [x] 335 tests, 100% line/branch/function/statement coverage âœ…

---

---

## Dev Color Panel Reference

Moved to `docs/dev-color-panel.md`.
